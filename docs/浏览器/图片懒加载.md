---
category: 浏览器
---

# 图片懒加载方案

思路：对于所有图片，首先设置一个默认图片来占位，当图片出现在当前视口中时，再加载其实际内容。

监听图片是否在视口中的方案，有以下几种：

## clientHeight、scrollTop、offsetTop
```js
const dom = document.getElementById('targetImg');
window.addEventListener('scroll',function(){
    // 视口总高度
    const viewHeight = document.documentElement.clientHeight;
    
    // 滚动条已滚动的高度
    const scrollHeight = document.documentElement.scrollTop;

    // 元素出现的位置的高度
    const offsetHeight = dom.offsetTop;
    if(offsetHeight <= viewHeight + scrollHeight){
        // ... 加载图片
    }
})
```

## getBoundingClientRect

`getBoundingClientRect`方法返回一个描述元素的`DOMRect`对象。

该对象提供了`top`方法获取矩形左上角距离视口顶部的距离。

因此判断图片是否出现的逻辑就是：
```js
dom.getBoundingClientRect().top < document.documentElement.clientHeight
```

## IntersectionObserver

`IntersectionObserver`是浏览器提供的内置API，实现了监听滚动条scroll事件、判断是否在视口内、节流三个功能。

```js
const imgs = document.getElementsByTagName('img');

const observer = new IntersectionObserver(elems => {
    for(let elem of elems){
        // 处于视口之中
        if(elem.isIntersecting){
            // 实际加载图片
        }
    }
})
```