# Vue如何实现双向绑定

双向绑定是指，视图层发生变化时自动更新Data中的数据；Data中数据改变时自动更新视图。



实现方式：通过`Object.defineProperty`为数据添加setter和getter，监听数据的改变和读取。当数据变化时通知视图更新。



四个组成部分：

- 监听器**Observer**：让数据变得**可观测**，也就是每次进进行读或写时可以被感知。对数据对象进行遍历，包括子属性对象的属性，利用 Object.defineProperty() 对属性都加上 setter 和 getter。
- 订阅者**Watcher**： 订阅 Observer 中的属性值变化的消息，当收到属性值变化的消息时，触发解析器 Compile 中对应的更新函数 。
- 订阅器**Dep**： 采用发布-订阅设计模式，用来收集Watcher，对Watcher和Observer进行统一管理。 
- 解析器**Complie**：解析Vue模板，将其中变量替换为数据，并在每个指令对应的节点绑定更新函数，添加监听数据的Watcher。




# $set如何实现新加/修改对象和数组的同时保持响应式

通过源码可得知：

- 如果目标是数组，首先判断索引是否大于当前的length，若大于则先修改length。然后调用splice方法
- 如果是对象，则判断属性是否存在、该对象是否是响应式的：
    - 如果该属性已经存在，或该对象不是响应式的，则直接赋值
    - 否则：调用内部`defineReactive`方法（Vue初始化时给对象属性添加setter和getter的方法），对该属性添加getter和setter