---
category: 前端
tag:
    - vue
---

# 组件间通信方式有哪些

## 1. 最常用方式，props：父子组件

- 父组件用`props`向子组件传值
- 子组件用`$emit`触发自定义事件，向父组件传值



## 2. 通过ref、`$parent`、`$children`：父子组件

`ref`用来便捷的访问某个节点或是自定义组件。

> ref只会在组件渲染完成后生效，并且**不是响应式的**

- 用在DOM节点上时和ID类似
- 用在组件上时获取的是这个Vue实例
- ref与v-for一起使用时，得到的是包含了所有子组件的数组

```html
<myCom ref="myInput" />
```

```js
// 获取这个组件，类似于获得了它的this指针
this.$refs.myInput;
```

`$parent`用于获得组件的父组件，可以获取其数据或调用其方法。

`$children`用于获得组件的子组件。**在vue3中已移除**，需要时用ref作为代替



## 3. 依赖注入：隔代组件

使用方法：

- 在父组件使用`provide`属性，向所有子组件（不只是直接子组件，包括深层嵌套的子组件）提供值
- 在子组件中用inject属性进行接收

缺点：

- 是非响应式的。
- 使组件和组织方式耦合起来，不利于重构

```js
// 父组件
{
  // ...
  provide(){
    return{
      name: this.name
    }
  }
}

// 所有子组件或子组件的子组件中都可以接收：
{
  inject:['name']
}
```



## 4. $attrs/$listeners：隔代组件

- `$attrs`：包含了父组件传递了但没有在props中进行接收的props（class和style除外）
- `$listeners`：包含了父级作用域中的v-on监听器

即，通过`attrs`将祖父组件传来的props传给孙子组件；将祖父组件的事件监听器，添加到孙子组件



## 5. 总线模式/发布订阅模式：全局可用，低配版Vuex

1. 用一个空的Vue实例作为中心事件总线，用它来监听和触发事件，从而实现组件间通信。

```js
// $bus为事件总线的名称，自己随意定义
Vue.prototype.$bus = new Vue();

new Vue({}).$mount('#app')
```

2. 在需要传递信息的地方触发自定义事件

```js
this.$bus.$emit('事件名','事件参数')
```

3. 在需要接收的地方监听事件

```js
this.$bus.$on('事件名',(arg)=>{})
```

总线模式的缺点：

- vue是SPA，在某个页面刷新后，与之相关的eventbus会被移除
- 不利于组件化开发

## 6. 终极方案：Vuex