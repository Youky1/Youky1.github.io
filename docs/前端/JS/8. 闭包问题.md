---
title: 闭包问题
category: 面试题
tag:
    - JS

---



# 闭包的定义

有权访问**另一个函数作用域**中变量的**函数**。



# 闭包产生的原因

当前作用域中有对父级作用域的引用。

并不一定要通过返回函数的形式，也可以通过让外部变量保存对父级作用域的引用来体现。



# 如何解决因闭包产生的循环输出问题

```js
for(var i = 1; i <= 5; i ++){
  setTimeout(function timer(){
    console.log(i)
  }, 0)
}
```

输出结果都是6的原因：setTimeout作为宏任务加入任务队列。同步任务执行结束执行内部回调时，向父级作用域查找i，而i此时已经变成6了。



解决方案：

1. 使用let替换var，因为let创建的是块级变量
2. 将i作为setTimeout的第三个参数传入

```js
for(var i=1;i<=5;i++){
  setTimeout(function timer(j){
    console.log(j)
  }, 0, i)
}
```

3. 使用IIFE（立即执行函数），把当前状态的i传入

```js
for(var i = 1;i <= 5;i++){
  (function(j){
    setTimeout(function timer(){
      console.log(j)
    }, 0)
  })(i)
}
```







